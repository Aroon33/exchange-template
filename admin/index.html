<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>CryptoX Admin - ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- å…±é€š + Admin å°‚ç”¨CSS -->
  <link rel="stylesheet" href="../assets/css/style.css">
  <link rel="stylesheet" href="../assets/css/admin.css">
</head>
<body>
  <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
  <aside class="sidebar">
    <div class="sidebar-title">ãƒ¡ãƒ‹ãƒ¥ãƒ¼</div>
    <ul class="nav-list">
      <li class="nav-item">
        <a href="index.html" class="nav-link active">
          <span class="nav-icon">ğŸ </span><span>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</span>
        </a>
      </li>
      <li class="nav-item">
        <a href="tickets.html" class="nav-link">
          <span class="nav-icon">ğŸ’¬</span><span>å•ã„åˆã‚ã›ç®¡ç†</span>
        </a>
      </li>
      <li class="nav-item">
        <a href="users.html" class="nav-link">
          <span class="nav-icon">ğŸ‘¥</span><span>ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§</span>
        </a>
      </li>
      <li class="nav-item">
        <a href="trades.html" class="nav-link">
          <span class="nav-icon">ğŸ“Š</span><span>å–å¼•çŠ¶æ³</span>
        </a>
      </li>
      <li class="nav-item">
        <a href="kyc.html" class="nav-link">
          <span class="nav-icon">ğŸ“Š</span><span>KYCçŠ¶æ³</span>
        </a>
      </li>
      <li class="nav-item">
        <a href="deposit.html" class="nav-link">
          <span class="nav-icon">â•</span><span>å…¥é‡‘ç”³è«‹</span>
        </a>
      </li>
      <li class="nav-item">
        <a href="withdraw.html" class="nav-link">
          <span class="nav-icon">â–</span><span>å‡ºé‡‘ç”³è«‹</span>
        </a>
      </li>
      <li class="nav-item">
        <a href="group.html" class="nav-link">
          <span class="nav-icon">ğŸ§©</span><span>ã‚°ãƒ«ãƒ¼ãƒ—ç®¡ç†</span>
        </a>
      </li>
      <li class="nav-item">
        <a href="settings.html" class="nav-link">
          <span class="nav-icon">âš™ï¸</span><span>ã‚·ã‚¹ãƒ†ãƒ è¨­å®š</span>
        </a>
      </li>
    </ul>
    <div class="sidebar-footer">
      CryptoX Admin<br />UI Demo &copy; 2025
    </div>
  </aside>

  <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <header class="admin-header">
    <div class="admin-header-left">
      <div class="admin-logo-badge">AX</div>
      <div>
        <div class="admin-logo-text">Admin Console</div>
        <div class="admin-logo-sub">CryptoX Exchange</div>
      </div>
    </div>
    <div class="admin-header-right">
      <span>ç®¡ç†è€…ï¼šadmin@example.com</span>
      <button class="btn btn-outline btn-sm" onclick="location.href='../login.html'">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆï¼ˆãƒ‡ãƒ¢ï¼‰</button>
    </div>
  </header>

  <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
  <main class="admin-main">
    <div class="admin-main-inner">
      <div class="page-title">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</div>
      <div class="page-sub">
        å…¨ä½“ã®çŠ¶æ³ã‚’ç¢ºèªã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ / å…¥å‡ºé‡‘ / å•ã„åˆã‚ã›ã«ç´ æ—©ãã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚
      </div>

      <!-- æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
      <section class="search-card">
        <div class="search-row-top">
          <div>
            <div class="search-title">ã‚°ãƒ­ãƒ¼ãƒãƒ«æ¤œç´¢</div>
            <div class="search-meta">
              ãƒ¦ãƒ¼ã‚¶ãƒ¼å / ãƒ¡ãƒ¼ãƒ« / ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆã‚³ãƒ¼ãƒ‰ / æ—¥ä»˜ã§çµã‚Šè¾¼ã¿ã§ãã¾ã™ã€‚
            </div>
          </div>
          <span class="tag">å¯¾è±¡ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼ / å…¥å‡ºé‡‘ / å•ã„åˆã‚ã›</span>
        </div>

        <div class="search-grid">
          <div class="form-field">
            <label>ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼ˆåå‰ãƒ»ãƒ¡ãƒ¼ãƒ«ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼IDï¼‰</label>
            <input type="text" id="q-text" placeholder="ä¾‹ï¼šTaro / user@example.com / user-demo-001" />
          </div>
          <div class="form-field">
            <label>ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆã‚³ãƒ¼ãƒ‰</label>
            <input type="text" id="q-affiliate" placeholder="ä¾‹ï¼šAFF-12345" />
          </div>
          <div class="form-field">
            <label>æœŸé–“ï¼ˆFromï¼‰</label>
            <input type="date" id="q-from" />
          </div>
          <div class="form-field">
            <label>æœŸé–“ï¼ˆToï¼‰</label>
            <input type="date" id="q-to" />
          </div>
        </div>

        <div class="search-actions">
          <button class="btn-xs" id="btn-clear">æ¡ä»¶ã‚¯ãƒªã‚¢</button>
          <button class="btn-xs btn-xs-primary" id="btn-search">æ¤œç´¢</button>
        </div>
      </section>

      <!-- ã‚µãƒãƒªãƒ¼ -->
      <section class="summary-grid">
        <div class="summary-card">
          <div class="summary-label">ç·ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ï¼ˆãƒ‡ãƒ¢ï¼‰</div>
          <div class="summary-value" id="sum-users">0</div>
          <div class="summary-sub">æœ¬ç•ªç’°å¢ƒã§ã¯DBã‹ã‚‰å–å¾—</div>
        </div>
        <div class="summary-card">
          <div class="summary-label">æœªå¯¾å¿œå•ã„åˆã‚ã›</div>
          <div class="summary-value" id="sum-tickets-new">0</div>
          <div class="summary-sub">status = new ã®ä»¶æ•°</div>
        </div>
        <div class="summary-card">
          <div class="summary-label">å…¥é‡‘ç”³è«‹ä¸­</div>
          <div class="summary-value" id="sum-dep-pending">0</div>
          <div class="summary-sub">pending å…¥é‡‘ç”³è«‹ï¼ˆãƒ‡ãƒ¢ï¼‰</div>
        </div>
        <div class="summary-card">
          <div class="summary-label">å‡ºé‡‘ç”³è«‹ä¸­</div>
          <div class="summary-value" id="sum-wd-pending">0</div>
          <div class="summary-sub">pending å‡ºé‡‘ç”³è«‹ï¼ˆãƒ‡ãƒ¢ï¼‰</div>
        </div>
      </section>

      <!-- æƒ…å ±ä¸€è¦§ãƒ†ãƒ¼ãƒ–ãƒ« -->
      <section class="table-card">
        <div class="table-header-row">
          <div class="table-title">ãƒ¦ãƒ¼ã‚¶ãƒ¼ / ç”³è«‹ / å•ã„åˆã‚ã› ä¸€è¦§ï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰</div>
          <div class="table-meta" id="table-meta">0ä»¶ã‚’è¡¨ç¤ºä¸­</div>
        </div>
        <table>
          <thead>
            <tr>
              <th class="sortable" data-sort-key="createdAt">ä½œæˆæ—¥æ™‚<span class="sort-indicator"></span></th>
              <th class="sortable" data-sort-key="type">ç¨®åˆ¥<span class="sort-indicator"></span></th>
              <th class="sortable" data-sort-key="nameOrTitle">åå‰ / ã‚¿ã‚¤ãƒˆãƒ«<span class="sort-indicator"></span></th>
              <th class="sortable" data-sort-key="userId">ãƒ¦ãƒ¼ã‚¶ãƒ¼ID<span class="sort-indicator"></span></th>
              <th class="sortable" data-sort-key="affiliateCode">ã‚¢ãƒ•ã‚£ãƒªã‚³ãƒ¼ãƒ‰<span class="sort-indicator"></span></th>
              <th class="sortable" data-sort-key="amount" style="text-align:right;">é‡‘é¡ï¼ˆUSDï¼‰<span class="sort-indicator"></span></th>
              <th class="sortable" data-sort-key="statusLabel">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹<span class="sort-indicator"></span></th>
            </tr>
          </thead>
          <tbody id="table-body"></tbody>
        </table>
      </section>
    </div>
  </main>

  <script>
    const rows = [
      {
        id: "user-001",
        type: "user",
        typeLabel: "ãƒ¦ãƒ¼ã‚¶ãƒ¼",
        nameOrTitle: "Taro Yamada",
        userId: "user-demo-001",
        affiliateCode: "AFF-12345",
        amount: null,
        status: "active",
        statusLabel: "æœ‰åŠ¹",
        createdAt: "2025-11-18 10:15",
      },
      {
        id: "user-002",
        type: "user",
        typeLabel: "ãƒ¦ãƒ¼ã‚¶ãƒ¼",
        nameOrTitle: "Hanako Suzuki",
        userId: "user-demo-002",
        affiliateCode: "AFF-77777",
        amount: null,
        status: "pending",
        statusLabel: "KYCç¢ºèªä¸­",
        createdAt: "2025-11-19 09:05",
      },
      {
        id: "ticket-001",
        type: "ticket",
        typeLabel: "å•ã„åˆã‚ã›",
        nameOrTitle: "å…¥é‡‘ãŒåæ˜ ã•ã‚Œã¾ã›ã‚“",
        userId: "user-demo-001",
        affiliateCode: "AFF-12345",
        amount: null,
        status: "new",
        statusLabel: "æœªå¯¾å¿œ",
        createdAt: "2025-11-19 08:30",
      },
      {
        id: "dep-001",
        type: "deposit",
        typeLabel: "å…¥é‡‘ç”³è«‹",
        nameOrTitle: "éŠ€è¡ŒæŒ¯è¾¼ JPY",
        userId: "user-demo-003",
        affiliateCode: "AFF-00001",
        amount: 1000.0,
        status: "pending",
        statusLabel: "ç”³è«‹ä¸­",
        createdAt: "2025-11-19 07:45",
      },
      {
        id: "wd-001",
        type: "withdraw",
        typeLabel: "å‡ºé‡‘ç”³è«‹",
        nameOrTitle: "BTC å‡ºé‡‘",
        userId: "user-demo-001",
        affiliateCode: "AFF-12345",
        amount: 0.5 * 67000,
        status: "pending",
        statusLabel: "ç”³è«‹ä¸­",
        createdAt: "2025-11-18 22:10",
      },
      {
        id: "ticket-002",
        type: "ticket",
        typeLabel: "å•ã„åˆã‚ã›",
        nameOrTitle: "ã‚·ã‚¹ãƒ†ãƒ å–å¼•ã®è¨­å®šã«ã¤ã„ã¦",
        userId: "user-demo-004",
        affiliateCode: "",
        amount: null,
        status: "open",
        statusLabel: "å¯¾å¿œä¸­",
        createdAt: "2025-11-18 16:20",
      },
      {
        id: "dep-002",
        type: "deposit",
        typeLabel: "å…¥é‡‘ç”³è«‹",
        nameOrTitle: "USDT å…¥é‡‘",
        userId: "user-demo-002",
        affiliateCode: "AFF-77777",
        amount: 500.0,
        status: "completed",
        statusLabel: "å®Œäº†",
        createdAt: "2025-11-17 19:00",
      },
      {
        id: "wd-002",
        type: "withdraw",
        typeLabel: "å‡ºé‡‘ç”³è«‹",
        nameOrTitle: "USDT å‡ºé‡‘",
        userId: "user-demo-005",
        affiliateCode: "",
        amount: 200.0,
        status: "admin_cancel",
        statusLabel: "ç®¡ç†å´ã‚­ãƒ£ãƒ³ã‚»ãƒ«",
        createdAt: "2025-11-17 15:30",
      },
      {
        id: "user-003",
        type: "user",
        typeLabel: "ãƒ¦ãƒ¼ã‚¶ãƒ¼",
        nameOrTitle: "Suspended User",
        userId: "user-demo-999",
        affiliateCode: "AFF-99999",
        amount: null,
        status: "suspended",
        statusLabel: "åœæ­¢ä¸­",
        createdAt: "2025-11-10 11:11",
      }
    ];

    const qTextEl = document.getElementById("q-text");
    const qAffEl = document.getElementById("q-affiliate");
    const qFromEl = document.getElementById("q-from");
    const qToEl = document.getElementById("q-to");
    const btnSearch = document.getElementById("btn-search");
    const btnClear = document.getElementById("btn-clear");
    const tableBody = document.getElementById("table-body");
    const tableMeta = document.getElementById("table-meta");
    const sumUsersEl = document.getElementById("sum-users");
    const sumTicketsNewEl = document.getElementById("sum-tickets-new");
    const sumDepPendingEl = document.getElementById("sum-dep-pending");
    const sumWdPendingEl = document.getElementById("sum-wd-pending");

    let currentSortKey = "createdAt";
    let currentSortDir = "desc";
    let filteredRows = rows.slice();

    function parseDateTime(str) {
      return new Date(str.replace(" ", "T"));
    }

    function applyFilters() {
      const text = qTextEl.value.trim().toLowerCase();
      const aff = qAffEl.value.trim().toLowerCase();
      const fromVal = qFromEl.value;
      const toVal = qToEl.value;

      filteredRows = rows.filter((r) => {
        if (text) {
          const haystack = (r.nameOrTitle || "").toLowerCase() + " " + (r.userId || "").toLowerCase();
          if (!haystack.includes(text)) return false;
        }
        if (aff) {
          const code = (r.affiliateCode || "").toLowerCase();
          if (!code.includes(aff)) return false;
        }
        if (fromVal) {
          const fromTs = new Date(fromVal + "T00:00:00").getTime();
          if (parseDateTime(r.createdAt).getTime() < fromTs) return false;
        }
        if (toVal) {
          const toTs = new Date(toVal + "T23:59:59").getTime();
          if (parseDateTime(r.createdAt).getTime() > toTs) return false;
        }
        return true;
      });

      applySort();
      renderTable();
    }

    function applySort() {
      const key = currentSortKey;
      const dir = currentSortDir;

      filteredRows.sort((a, b) => {
        let va, vb;
        if (key === "createdAt") {
          va = parseDateTime(a.createdAt).getTime();
          vb = parseDateTime(b.createdAt).getTime();
        } else if (key === "amount") {
          va = a.amount == null ? -Infinity : a.amount;
          vb = b.amount == null ? -Infinity : b.amount;
        } else {
          va = (a[key] || "").toString().toLowerCase();
          vb = (b[key] || "").toString().toLowerCase();
        }
        if (va < vb) return dir === "asc" ? -1 : 1;
        if (va > vb) return dir === "asc" ? 1 : -1;
        return 0;
      });
    }

    function renderTable() {
      tableBody.innerHTML = "";
      filteredRows.forEach((r) => {
        const tr = document.createElement("tr");
        tr.className = "table-row";

        const statusChip = (() => {
          if (r.type === "user") {
            if (r.status === "active") return `<span class="status-chip status-active">æœ‰åŠ¹</span>`;
            if (r.status === "pending") return `<span class="status-chip status-pending">KYCç¢ºèªä¸­</span>`;
            if (r.status === "suspended") return `<span class="status-chip status-suspended">åœæ­¢ä¸­</span>`;
          } else if (r.type === "ticket") {
            if (r.status === "new") return `<span class="status-chip status-pending">æœªå¯¾å¿œ</span>`;
            if (r.status === "open") return `<span class="status-chip status-active">å¯¾å¿œä¸­</span>`;
            if (r.status === "closed") return `<span class="status-chip status-suspended">å¯¾å¿œæ¸ˆ</span>`;
          } else if (r.type === "deposit" || r.type === "withdraw") {
            if (r.status === "pending") return `<span class="status-chip status-pending">ç”³è«‹ä¸­</span>`;
            if (r.status === "completed") return `<span class="status-chip status-active">å®Œäº†</span>`;
            if (r.status === "user_cancel") return `<span class="status-chip status-suspended">ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚­ãƒ£ãƒ³ã‚»ãƒ«</span>`;
            if (r.status === "admin_cancel") return `<span class="status-chip status-suspended">ç®¡ç†å´ã‚­ãƒ£ãƒ³ã‚»ãƒ«</span>`;
          }
          return `<span class="status-chip status-suspended">${r.statusLabel || "ä¸æ˜"}</span>`;
        })();

        const amountText =
          r.amount == null
            ? "-"
            : r.amount.toLocaleString("en-US", {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2,
              });

        tr.innerHTML = `
          <td>${r.createdAt}</td>
          <td>${r.typeLabel}</td>
          <td>${r.nameOrTitle}</td>
          <td>${r.userId || "-"}</td>
          <td>${r.affiliateCode || "-"}</td>
          <td class="amount">${amountText}</td>
          <td>${statusChip}</td>
        `;
        tableBody.appendChild(tr);
      });

      tableMeta.textContent = `${filteredRows.length}ä»¶ã‚’è¡¨ç¤ºä¸­`;
    }

    function updateSummary() {
      const userCount = rows.filter((r) => r.type === "user").length;
      const ticketNewCount = rows.filter((r) => r.type === "ticket" && r.status === "new").length;
      const depPendingCount = rows.filter((r) => r.type === "deposit" && r.status === "pending").length;
      const wdPendingCount = rows.filter((r) => r.type === "withdraw" && r.status === "pending").length;

      sumUsersEl.textContent = userCount;
      sumTicketsNewEl.textContent = ticketNewCount;
      sumDepPendingEl.textContent = depPendingCount;
      sumWdPendingEl.textContent = wdPendingCount;
    }

    document.querySelectorAll("th.sortable").forEach((th) => {
      th.addEventListener("click", () => {
        const key = th.dataset.sortKey;
        if (!key) return;
        if (currentSortKey === key) {
          currentSortDir = currentSortDir === "asc" ? "desc" : "asc";
        } else {
          currentSortKey = key;
          currentSortDir = "asc";
        }
        document.querySelectorAll("th.sortable .sort-indicator").forEach((el) => {
          el.textContent = "";
        });
        const indicator = th.querySelector(".sort-indicator");
        indicator.textContent = currentSortDir === "asc" ? "â–²" : "â–¼";

        applySort();
        renderTable();
      });
    });

    btnSearch.addEventListener("click", applyFilters);

    btnClear.addEventListener("click", () => {
      qTextEl.value = "";
      qAffEl.value = "";
      qFromEl.value = "";
      qToEl.value = "";
      filteredRows = rows.slice();
      applySort();
      renderTable();
    });

    function init() {
      updateSummary();
      const today = new Date();
      const isoToday = today.toISOString().slice(0, 10);
      const weekAgo = new Date(today.getTime() - 6 * 24 * 60 * 60 * 1000);
      const isoWeekAgo = weekAgo.toISOString().slice(0, 10);
      qToEl.value = isoToday;
      qFromEl.value = isoWeekAgo;

      applyFilters();
      const th = document.querySelector('th[data-sort-key="createdAt"]');
      if (th) {
        th.querySelector(".sort-indicator").textContent = "â–¼";
      }
    }

    init();
  </script>
</body>
</html>

