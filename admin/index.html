<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>CryptoX Admin - ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- å…±é€š + Admin å°‚ç”¨CSS -->
  <link rel="stylesheet" href="../assets/css/style.css">
  <link rel="stylesheet" href="../assets/css/admin.css">
</head>
<body>
  <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
  <aside class="sidebar">
    <div class="sidebar-title">ãƒ¡ãƒ‹ãƒ¥ãƒ¼</div>
    <ul class="nav-list">
      <li class="nav-item">
        <a href="index.html" class="nav-link active">
          <span class="nav-icon">ğŸ </span><span>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</span>
        </a>
      </li>
      <li class="nav-item">
        <a href="tickets.html" class="nav-link">
          <span class="nav-icon">ğŸ’¬</span><span>å•ã„åˆã‚ã›ç®¡ç†</span>
        </a>
      </li>
      <li class="nav-item">
        <a href="users.html" class="nav-link">
          <span class="nav-icon">ğŸ‘¥</span><span>ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§</span>
        </a>
      </li>
      <li class="nav-item">
        <a href="trades.html" class="nav-link">
          <span class="nav-icon">ğŸ“Š</span><span>å–å¼•çŠ¶æ³</span>
        </a>
      </li>
      <li class="nav-item">
        <a href="kyc.html" class="nav-link">
          <span class="nav-icon">ğŸ“Š</span><span>KYCçŠ¶æ³</span>
        </a>
      </li>
      <li class="nav-item">
        <a href="deposit.html" class="nav-link">
          <span class="nav-icon">â•</span><span>å…¥é‡‘ç”³è«‹</span>
        </a>
      </li>
      <li class="nav-item">
        <a href="withdraw.html" class="nav-link">
          <span class="nav-icon">â–</span><span>å‡ºé‡‘ç”³è«‹</span>
        </a>
      </li>
      <li class="nav-item">
        <a href="group.html" class="nav-link">
          <span class="nav-icon">ğŸ§©</span><span>ã‚°ãƒ«ãƒ¼ãƒ—ç®¡ç†</span>
        </a>
      </li>
      <li class="nav-item">
        <a href="settings.html" class="nav-link">
          <span class="nav-icon">âš™ï¸</span><span>ã‚·ã‚¹ãƒ†ãƒ è¨­å®š</span>
        </a>
      </li>
    </ul>
    <div class="sidebar-footer">
      CryptoX Admin<br />UI Demo &copy; 2025
    </div>
  </aside>

  <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <header class="admin-header">
    <div class="admin-header-left">
      <div class="admin-logo-badge">AX</div>
      <div>
        <div class="admin-logo-text">Admin Console</div>
        <div class="admin-logo-sub">CryptoX Exchange</div>
      </div>
    </div>
    <div class="admin-header-right">
      <span>ç®¡ç†è€…ï¼šadmin@example.com</span>
      <button class="btn btn-outline btn-sm" onclick="location.href='../login.html'">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆï¼ˆãƒ‡ãƒ¢ï¼‰</button>
    </div>
  </header>

  <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
  <main class="admin-main">
    <div class="admin-main-inner">
      <div class="page-title">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</div>
      <div class="page-sub">
      </div>

      <!-- æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
      <section class="search-card">
        <div class="search-row-top">
          <div>
            <div class="search-title">ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢</div>
            <div class="search-meta">
              ãƒ¦ãƒ¼ã‚¶ãƒ¼å / ãƒ¡ãƒ¼ãƒ« /  æ—¥ä»˜ã€‚
            </div>
          </div>
          <span class="tag">å¯¾è±¡ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼ / å…¥å‡ºé‡‘ / å•ã„åˆã‚ã›</span>
        </div>

        <div class="search-grid">
          <div class="form-field">
            <label>ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰</label>
            <input type="text" id="q-text" placeholder="ä¾‹ï¼šTaro / user@example.com / user-demo-001" />
          </div>
          <div class="form-field">
            <label>ç´¹ä»‹ã‚³ãƒ¼ãƒ‰</label>
            <input type="text" id="q-affiliate" placeholder="ä¾‹ï¼šAFF-12345" />
          </div>
          <div class="form-field">
            <label>æœŸé–“ï¼ˆFromï¼‰</label>
            <input type="date" id="q-from" />
          </div>
          <div class="form-field">
            <label>æœŸé–“ï¼ˆToï¼‰</label>
            <input type="date" id="q-to" />
          </div>
        </div>

        <div class="search-actions">
          <button class="btn-xs" id="btn-clear">æ¡ä»¶ã‚¯ãƒªã‚¢</button>
          <button class="btn-xs btn-xs-primary" id="btn-search">æ¤œç´¢</button>
        </div>
      </section>

<section class="card" style="margin-bottom: 20px;">
  <h1 class="card-title">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
  <p class="card-sub"></p>

  <div class="info-grid">
    <div class="info-row">
      <span class="info-label">ç·ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°</span>
      <span class="info-value" id="admin-total-users">-</span>
    </div>
    <div class="info-row">
      <span class="info-label">åˆè¨ˆå£åº§æ®‹é«˜</span>
      <span class="info-value" id="admin-total-balance">-</span>
    </div>
    <div class="info-row">
      <span class="info-label">å…¥é‡‘ç”³è«‹ï¼ˆPENDINGï¼‰</span>
      <span class="info-value" id="admin-pending-deposits">-</span>
    </div>
    <div class="info-row">
      <span class="info-label">å‡ºé‡‘ç”³è«‹ï¼ˆPENDINGï¼‰</span>
      <span class="info-value" id="admin-pending-withdraws">-</span>
    </div>
    <div class="info-row">
      <span class="info-label">KYCæœªå‡¦ç†ä»¶æ•°</span>
      <span class="info-value" id="admin-pending-kyc">-</span>
    </div>
    <div class="info-row">
      <span class="info-label">æœªå¯¾å¿œãƒã‚±ãƒƒãƒˆæ•°</span>
      <span class="info-value" id="admin-open-tickets">-</span>
    </div>
  </div>

  <p id="admin-dashboard-message" class="muted" style="margin-top: 8px;"></p>
</section>


      <!-- ã‚µãƒãƒªãƒ¼ -->
      <section class="summary-grid">
        <div class="summary-card">
          <div class="admin-total-users">ç·ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ï¼ˆãƒ‡ãƒ¢ï¼‰</div>
          <div class="summary-value" id="admin-total-users">0</div>
          <div class="summary-sub">æœ¬ç•ªç’°å¢ƒã§ã¯DBã‹ã‚‰å–å¾—</div>
        </div>
        <div class="summary-card">
          <div class="summary-label">æœªå¯¾å¿œå•ã„åˆã‚ã›</div>
          <div class="summary-value" id="sum-tickets-new">0</div>
          <div class="summary-sub">status = new ã®ä»¶æ•°</div>
        </div>
        <div class="summary-card">
          <div class="summary-label">å…¥é‡‘ç”³è«‹ä¸­</div>
          <div class="summary-value" id="admin-pending-deposits">0</div>
          <div class="summary-sub">pending å…¥é‡‘ç”³è«‹ï¼ˆãƒ‡ãƒ¢ï¼‰</div>
        </div>
        <div class="summary-card">
          <div class="summary-label">å‡ºé‡‘ç”³è«‹ä¸­</div>
          <div class="summary-value" id="admin-pending-withdraws">0</div>
          <div class="summary-sub">pending å‡ºé‡‘ç”³è«‹ï¼ˆãƒ‡ãƒ¢ï¼‰</div>
        </div>
      </section>

      <!-- æƒ…å ±ä¸€è¦§ãƒ†ãƒ¼ãƒ–ãƒ« -->
      <section class="table-card">
        <div class="table-header-row">
          <div class="table-title">ãƒ¦ãƒ¼ã‚¶ãƒ¼ / ç”³è«‹ / å•ã„åˆã‚ã› ä¸€è¦§ï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰</div>
          <div class="table-meta" id="table-meta">0ä»¶ã‚’è¡¨ç¤ºä¸­</div>
        </div>
        <table>
          <thead>
            <tr>
              <th class="sortable" data-sort-key="createdAt">ä½œæˆæ—¥æ™‚<span class="sort-indicator"></span></th>
              <th class="sortable" data-sort-key="type">ç¨®åˆ¥<span class="sort-indicator"></span></th>
              <th class="sortable" data-sort-key="nameOrTitle">åå‰ / ã‚¿ã‚¤ãƒˆãƒ«<span class="sort-indicator"></span></th>
              <th class="sortable" data-sort-key="userId">ãƒ¦ãƒ¼ã‚¶ãƒ¼ID<span class="sort-indicator"></span></th>
              <th class="sortable" data-sort-key="affiliateCode">ã‚¢ãƒ•ã‚£ãƒªã‚³ãƒ¼ãƒ‰<span class="sort-indicator"></span></th>
              <th class="sortable" data-sort-key="amount" style="text-align:right;">é‡‘é¡ï¼ˆUSDï¼‰<span class="sort-indicator"></span></th>
              <th class="sortable" data-sort-key="statusLabel">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹<span class="sort-indicator"></span></th>
            </tr>
          </thead>
          <tbody id="table-body"></tbody>
        </table>
      </section>
    </div>
  </main>

  <script>
    const ADMIN_API_BASE = "https://api.exchange-template.com";

    const elTotalUsers   = document.getElementById("admin-total-users");
    const elTotalBalance = document.getElementById("admin-total-balance");
    const elPendDep      = document.getElementById("admin-pending-deposits");
    const elPendWit      = document.getElementById("admin-pending-withdraws");
    const elPendKyc      = document.getElementById("admin-pending-kyc");
    const elOpenTickets  = document.getElementById("admin-open-tickets");
    const elMsg          = document.getElementById("admin-dashboard-message");

    async function adminApiGet(path) {
      const res = await fetch(ADMIN_API_BASE + path, {
        credentials: "include",
      });
      if (!res.ok) {
        const txt = await res.text();
        throw new Error("GET " + path + " failed: " + txt);
      }
      return res.json();
    }

    function fmtAmount(v) {
      if (v == null) return "-";
      const n = Number(v);
      if (isNaN(n)) return String(v);
      return n.toLocaleString("en-US", {
        minimumFractionDigits: 2,
        maximumFractionDigits: 8,
      });
    }

    (async function initAdminDashboard() {
      try {
        const data = await adminApiGet("/admin/overview");

        if (elTotalUsers)   elTotalUsers.textContent   = String(data.totalUsers ?? 0);
        if (elTotalBalance) elTotalBalance.textContent = fmtAmount(data.totalBalance ?? 0);
        if (elPendDep)      elPendDep.textContent      = String(data.pendingDeposits ?? 0);
        if (elPendWit)      elPendWit.textContent      = String(data.pendingWithdraws ?? 0);
        if (elPendKyc)      elPendKyc.textContent      = String(data.pendingKyc ?? 0);
        if (elOpenTickets)  elOpenTickets.textContent  = String(data.openTickets ?? 0);

        if (elMsg) {
          elMsg.textContent = "ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æƒ…å ±ã‚’æ›´æ–°ã—ã¾ã—ãŸã€‚";
          elMsg.style.color = "green";
        }
      } catch (e) {
        console.error(e);
        if (elMsg) {
          elMsg.textContent = "ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã¨æ¨©é™ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚";
          elMsg.style.color = "red";
        }
      }
    })();
  </script>
</body>
</html>

