<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>CryptoX Admin - ã‚°ãƒ«ãƒ¼ãƒ—ç®¡ç†</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- å…±é€š + Admin å°‚ç”¨CSS -->
  <link rel="stylesheet" href="../assets/css/style.css">
  <link rel="stylesheet" href="../assets/css/admin.css">
</head>
<body>
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-title">ãƒ¡ãƒ‹ãƒ¥ãƒ¼</div>
    <ul class="nav-list">
      <li class="nav-item"><a href="index.html" class="nav-link"><span class="nav-icon">ğŸ </span><span>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</span></a></li>
      <li class="nav-item"><a href="tickets.html" class="nav-link"><span class="nav-icon">ğŸ’¬</span><span>å•ã„åˆã‚ã›ç®¡ç†</span></a></li>
      <li class="nav-item"><a href="users.html" class="nav-link"><span class="nav-icon">ğŸ‘¥</span><span>ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§</span></a></li>
      <li class="nav-item"><a href="kyc.html" class="nav-link"><span class="nav-icon">ğŸªª</span><span>KYCç¢ºèª</span></a></li>
      <li class="nav-item"><a href="trades.html" class="nav-link"><span class="nav-icon">ğŸ“Š</span><span>å–å¼•çŠ¶æ³</span></a></li>
      <li class="nav-item"><a href="deposit.html" class="nav-link"><span class="nav-icon">â•</span><span>å…¥é‡‘ç”³è«‹</span></a></li>
      <li class="nav-item"><a href="withdraw.html" class="nav-link"><span class="nav-icon">â–</span><span>å‡ºé‡‘ç”³è«‹</span></a></li>
      <li class="nav-item"><a href="group.html" class="nav-link active"><span class="nav-icon">ğŸ§©</span><span>ã‚°ãƒ«ãƒ¼ãƒ—ç®¡ç†</span></a></li>
      <li class="nav-item"><a href="settings.html" class="nav-link"><span class="nav-icon">âš™ï¸</span><span>ã‚·ã‚¹ãƒ†ãƒ è¨­å®š</span></a></li>
    </ul>
    <div class="sidebar-footer">
      CryptoX Admin<br>UI Demo &copy; 2025
    </div>
  </aside>

  <!-- Header -->
  <header class="admin-header">
    <div class="admin-header-left">
      <div class="admin-logo-badge">AX</div>
      <div>
        <div class="admin-logo-text">Admin Console</div>
        <div class="admin-logo-sub">ã‚°ãƒ«ãƒ¼ãƒ—ç®¡ç†</div>
      </div>
    </div>
    <div class="admin-header-right">
      <span>ç®¡ç†è€…ï¼šadmin@example.com</span>
      <button class="btn btn-outline btn-sm" onclick="location.href='../login.html'">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆï¼ˆãƒ‡ãƒ¢ï¼‰</button>
    </div>
  </header>

  <!-- Main -->
  <main class="admin-main">
    <div class="admin-main-inner">
      <div class="page-title">ã‚°ãƒ«ãƒ¼ãƒ—ç®¡ç†</div>
      <div class="page-sub">
        ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ A / B / C / D ãªã©ã®ã‚°ãƒ«ãƒ¼ãƒ—ï¼ˆã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ©ãƒ³ï¼‰ã«æŒ¯ã‚Šåˆ†ã‘ã‚‹ç®¡ç†ç”»é¢ã§ã™ã€‚<br>
        ç™»éŒ²æ—¥ãƒ»ã‚¢ãƒ•ã‚£ãƒªã‚³ãƒ¼ãƒ‰ãƒ»ç¾åœ¨ã‚°ãƒ«ãƒ¼ãƒ—ã§æ¤œç´¢ã—ã¦ã€ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‹ã‚‰ä¸€æ‹¬ã¾ãŸã¯å€‹åˆ¥ã«ç§»å‹•ã§ãã¾ã™ã€‚
      </div>

      <!-- Group cards -->
      <section class="group-grid" id="group-grid">
        <!-- JSã§ç”Ÿæˆ -->
      </section>

      <!-- Filters + bulk -->
      <section class="filters-card">
        <div class="filters-row">
          <div>
            <div class="filters-title">ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼</div>
            <div class="filters-meta">
              ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ / ç™»éŒ²æ—¥ / ã‚¢ãƒ•ã‚£ãƒªã‚³ãƒ¼ãƒ‰ / ç¾åœ¨ã‚°ãƒ«ãƒ¼ãƒ—ã§çµã‚Šè¾¼ã¿ã¾ã™ã€‚ã‚°ãƒ«ãƒ¼ãƒ—ã‚«ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€ãã®ã‚°ãƒ«ãƒ¼ãƒ—ã ã‘ã«çµã‚‰ã‚Œã¾ã™ã€‚
            </div>
          </div>
        </div>
        <div class="filters-grid">
          <div class="field">
            <label>ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼ˆåå‰ãƒ»ãƒ¡ãƒ¼ãƒ«ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼IDï¼‰</label>
            <input type="text" id="f-keyword" placeholder="ä¾‹ï¼šTaro / user@example.com / user-demo-001" />
          </div>
          <div class="field">
            <label>ã‚¢ãƒ•ã‚£ãƒªã‚³ãƒ¼ãƒ‰</label>
            <input type="text" id="f-aff" placeholder="ä¾‹ï¼šAFF-12345" />
          </div>
          <div class="field">
            <label>ç™»éŒ²æ—¥ï¼ˆFromï¼‰</label>
            <input type="date" id="f-from" />
          </div>
          <div class="field">
            <label>ç™»éŒ²æ—¥ï¼ˆToï¼‰</label>
            <input type="date" id="f-to" />
          </div>
        </div>
        <div class="bulk-row">
          <div class="bulk-controls">
            <span>ç¾åœ¨ã®ã‚°ãƒ«ãƒ¼ãƒ—ï¼š</span>
            <select id="f-group">
              <option value="all">ã™ã¹ã¦</option>
              <option value="A">Group A</option>
              <option value="B">Group B</option>
              <option value="C">Group C</option>
              <option value="D">Group D</option>
            </select>
            <button class="btn-xs" id="btn-filter">æ¤œç´¢</button>
            <button class="btn-xs" id="btn-clear">æ¡ä»¶ã‚¯ãƒªã‚¢</button>
          </div>
          <div class="bulk-controls">
            <span>é¸æŠã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’</span>
            <select id="bulk-target">
              <option value="">ç§»å‹•å…ˆã‚°ãƒ«ãƒ¼ãƒ—ã‚’é¸æŠ</option>
              <option value="A">Group A</option>
              <option value="B">Group B</option>
              <option value="C">Group C</option>
              <option value="D">Group D</option>
            </select>
            <button class="btn-xs btn-xs-primary" id="btn-bulk-move">ã‚°ãƒ«ãƒ¼ãƒ—ç§»å‹•</button>
          </div>
        </div>
      </section>

      <!-- User table -->
      <section class="table-card">
        <div class="card-header-row">
          <div>
            <div class="card-title-small">ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ï¼ˆã‚°ãƒ«ãƒ¼ãƒ—åˆ¥ï¼‰</div>
            <div class="card-sub-small" id="list-count">0ä»¶</div>
          </div>
          <div class="card-sub-small">ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã§ä¸€æ‹¬é¸æŠãŒå¯èƒ½ã§ã™ã€‚</div>
        </div>
        <table>
          <thead>
            <tr>
              <th><input type="checkbox" id="select-all" /></th>
              <th>ãƒ¦ãƒ¼ã‚¶ãƒ¼ID</th>
              <th>åå‰ / ãƒ¡ãƒ¼ãƒ«</th>
              <th>ç¾åœ¨ã‚°ãƒ«ãƒ¼ãƒ—</th>
              <th>ã‚¢ãƒ•ã‚£ãƒªã‚³ãƒ¼ãƒ‰</th>
              <th>ç™»éŒ²æ—¥</th>
              <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ / KYC</th>
              <th>å€‹åˆ¥ç§»å‹•</th>
            </tr>
          </thead>
          <tbody id="user-tbody">
            <!-- JSã§ç”Ÿæˆ -->
          </tbody>
        </table>
        <div class="note">
          â€» ã“ã®ãƒšãƒ¼ã‚¸ã¯ãƒ•ãƒ­ãƒ³ãƒˆã®ã¿ã®ãƒ‡ãƒ¢ã§ã™ã€‚å®Ÿéš›ã®ç’°å¢ƒã§ã¯ã€ã“ã®ã‚°ãƒ«ãƒ¼ãƒ—å¤‰æ›´å‡¦ç†ã‚’ API çµŒç”±ã§ DB ã® user.groupId ã«åæ˜ ã•ã›ã‚‹æƒ³å®šã§ã™ã€‚
        </div>
      </section>
    </div>
  </main>

  <div class="toast" id="toast"></div>
    <script>
    const API_BASE_URL = "https://api.exchange-template.com";

    const groupGridEl = document.getElementById("group-grid");
    const toastEl     = document.getElementById("toast");

    function showToast(msg) {
      if (!toastEl) return;
      toastEl.textContent = msg;
      toastEl.classList.add("show");
      setTimeout(() => toastEl.classList.remove("show"), 2200);
    }

    async function apiGet(path) {
      const res = await fetch(API_BASE + path, { credentials: "include" });
      if (!res.ok) throw new Error("GET " + path + " failed");
      return res.json();
    }

    async function apiPost(path, body) {
      const res = await fetch(API_BASE + path, {
        method: "POST",
        credentials: "include",
        headers: { "Content-Type": "application/json" },
        body: body ? JSON.stringify(body) : "{}",
      });
      const txt = await res.text();
      let json;
      try { json = txt ? JSON.parse(txt) : {}; } catch { json = { raw: txt }; }
      if (!res.ok) {
        console.error("POST " + path + " failed:", json);
        throw new Error("POST " + path + " failed");
      }
      return json;
    }

    async function loadGroups() {
      try {
        const groups = await apiGet("/groups");
        renderGroups(groups);
      } catch (e) {
        console.error(e);
        showToast("ã‚°ãƒ«ãƒ¼ãƒ—ä¸€è¦§ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
      }
    }

    function renderGroups(groups) {
      if (!groupGridEl) return;
      groupGridEl.innerHTML = "";

      if (!groups || groups.length === 0) {
        groupGridEl.innerHTML =
          '<div style="font-size:12px; color:var(--text-muted); padding:20px;">ã‚°ãƒ«ãƒ¼ãƒ—ãŒå­˜åœ¨ã—ã¾ã›ã‚“ã€‚</div>';
        return;
      }

      groups.forEach((g) => {
        const card = document.createElement("div");
        card.className = "group-card";
        card.innerHTML = `
          <div class="group-name">Group ID: ${g.id}</div>
          <div class="group-sub">${g.name || "ï¼ˆåå‰æœªè¨­å®šï¼‰"}</div>
          <div class="group-meta">ã‚¯ãƒªãƒƒã‚¯ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ã“ã®ã‚°ãƒ«ãƒ¼ãƒ—ã¸ç§»å‹•</div>
        `;

        card.addEventListener("click", () => onClickGroupCard(g));
        groupGridEl.appendChild(card);
      });
    }

    async function onClickGroupCard(group) {
      const userIdStr = prompt(`Group ID ${group.id} (${group.name || "ï¼ˆåå‰æœªè¨­å®šï¼‰"}) ã¸ç§»å‹•ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼š`);
      if (!userIdStr) return;
      const userId = Number(userIdStr);
      if (!userId || isNaN(userId)) {
        showToast("ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã¯æ•°å€¤ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
        return;
      }

      try {
        const res = await apiPost("/groups/change", { userId, groupId: group.id });
        console.log("group change result:", res);
        showToast(`ãƒ¦ãƒ¼ã‚¶ãƒ¼ID ${userId} ã‚’ Group ${group.id} ã«ç§»å‹•ã—ã¾ã—ãŸã€‚`);
      } catch (e) {
        console.error(e);
        showToast("ã‚°ãƒ«ãƒ¼ãƒ—å¤‰æ›´ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚·ã‚¹ãƒ†ãƒ åœæ­¢æ¸ˆã¿ã‹ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼IDãŒæ­£ã—ã„ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
      }
    }

    (function init() {
      loadGroups();
    })();
  </script>




</body>
</html>

