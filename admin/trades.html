<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>CryptoX Admin - ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- å…±é€š + Admin å°‚ç”¨CSS -->
  <link rel="stylesheet" href="../assets/css/style.css">
  <link rel="stylesheet" href="../assets/css/admin.css">
</head>
<body>
  <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
  <aside class="sidebar">
    <div class="sidebar-title">ãƒ¡ãƒ‹ãƒ¥ãƒ¼</div>
    <ul class="nav-list">
      <li class="nav-item">
        <a href="index.html" class="nav-link active">
          <span class="nav-icon">ğŸ </span><span>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</span>
        </a>
      </li>
      <li class="nav-item">
        <a href="tickets.html" class="nav-link">
          <span class="nav-icon">ğŸ’¬</span><span>å•ã„åˆã‚ã›ç®¡ç†</span>
        </a>
      </li>
      <li class="nav-item">
        <a href="users.html" class="nav-link">
          <span class="nav-icon">ğŸ‘¥</span><span>ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§</span>
        </a>
      </li>
      <li class="nav-item">
        <a href="trades.html" class="nav-link">
          <span class="nav-icon">ğŸ“Š</span><span>å–å¼•çŠ¶æ³</span>
        </a>
      </li>
      <li class="nav-item">
        <a href="kyc.html" class="nav-link">
          <span class="nav-icon">ğŸ“Š</span><span>KYCçŠ¶æ³</span>
        </a>
      </li>
      <li class="nav-item">
        <a href="deposit.html" class="nav-link">
          <span class="nav-icon">â•</span><span>å…¥é‡‘ç”³è«‹</span>
        </a>
      </li>
      <li class="nav-item">
        <a href="withdraw.html" class="nav-link">
          <span class="nav-icon">â–</span><span>å‡ºé‡‘ç”³è«‹</span>
        </a>
      </li>
      <li class="nav-item">
        <a href="group.html" class="nav-link">
          <span class="nav-icon">ğŸ§©</span><span>ã‚°ãƒ«ãƒ¼ãƒ—ç®¡ç†</span>
        </a>
      </li>
      <li class="nav-item">
        <a href="settings.html" class="nav-link">
          <span class="nav-icon">âš™ï¸</span><span>ã‚·ã‚¹ãƒ†ãƒ è¨­å®š</span>
        </a>
      </li>
    </ul>
    <div class="sidebar-footer">
      CryptoX Admin<br />UI Demo &copy; 2025
    </div>
  </aside>

  <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <header class="admin-header">
    <div class="admin-header-left">
      <div class="admin-logo-badge">AX</div>
      <div>
        <div class="admin-logo-text">Admin Console</div>
        <div class="admin-logo-sub">CryptoX Exchange</div>
      </div>
    </div>
    <div class="admin-header-right">
      <span>ç®¡ç†è€…ï¼šadmin@example.com</span>
      <button class="btn btn-outline btn-sm" onclick="location.href='../login.html'">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆï¼ˆãƒ‡ãƒ¢ï¼‰</button>
    </div>
  </header>
<section class="table-card" style="margin-top: 16px;">
  <div class="card-header-row">
    <div>
      <div class="card-title-small">å–å¼•å±¥æ­´</div>
      <div class="card-sub-small" id="admin-trades-count">0ä»¶</div>
    </div>
    <button class="btn-xs" id="admin-trades-refresh">å†èª­ã¿è¾¼ã¿</button>
  </div>

  <table class="table">
    <thead>
      <tr>
        <th>ID</th>
        <th>ãƒ¦ãƒ¼ã‚¶ãƒ¼</th>
        <th>éŠ˜æŸ„</th>
        <th>å£²è²·</th>
        <th>æ•°é‡</th>
        <th>å»ºå€¤</th>
        <th>æ±ºæ¸ˆå€¤</th>
        <th>æç›Š</th>
        <th>æ±ºæ¸ˆæ—¥æ™‚</th>
      </tr>
    </thead>
    <tbody id="admin-trades-body">
      <tr>
        <td colspan="9" style="text-align:center; font-size:12px; color:var(--text-muted);">
          å–å¼•å±¥æ­´ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
        </td>
      </tr>
    </tbody>
  </table>

  <p id="admin-trades-message" class="muted" style="margin-top:8px;"></p>
</section>

<script>
  const ADMIN_API_BASE = "https://api.exchange-template.com";

  const elBody   = document.getElementById("admin-trades-body");
  const elMsg    = document.getElementById("admin-trades-message");
  const elCount  = document.getElementById("admin-trades-count");
  const btnReload= document.getElementById("admin-trades-refresh");

  async function adminApiGet(path) {
    const res = await fetch(ADMIN_API_BASE + path, {
      credentials: "include",
    });
    if (!res.ok) {
      const txt = await res.text();
      throw new Error("GET " + path + " failed: " + txt);
    }
    return res.json();
  }

  function fmtDate(iso) {
    if (!iso) return "-";
    return new Date(iso).toLocaleString("ja-JP", { hour12: false });
  }

  function fmtNum(v) {
    if (v == null) return "-";
    const n = Number(v);
    if (isNaN(n)) return String(v);
    return n.toLocaleString("en-US", {
      minimumFractionDigits: 2,
      maximumFractionDigits: 8,
    });
  }

  async function loadAdminTrades() {
    try {
      const trades = await adminApiGet("/trades/admin/all");

      elBody.innerHTML = "";

      if (!trades.length) {
        elBody.innerHTML =
          '<tr><td colspan="9" style="text-align:center; font-size:12px; color:var(--text-muted);">å–å¼•å±¥æ­´ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</td></tr>';
      } else {
        trades.forEach((t) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${t.id}</td>
            <td>${t.userId} / ${t.email}</td>
            <td>${t.symbol}</td>
            <td>${t.side}</td>
            <td>${fmtNum(t.size)}</td>
            <td>${fmtNum(t.entryPrice)}</td>
            <td>${fmtNum(t.closePrice)}</td>
            <td>${fmtNum(t.profit)}</td>
            <td>${fmtDate(t.closedAt)}</td>
          `;
          elBody.appendChild(tr);
        });
      }

      if (elCount) {
        elCount.textContent = (trades.length || 0) + "ä»¶";
      }
      if (elMsg) {
        elMsg.textContent = "å–å¼•å±¥æ­´ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸã€‚";
        elMsg.style.color = "green";
      }
    } catch (e) {
      console.error(e);
      if (elMsg) {
        elMsg.textContent = "å–å¼•å±¥æ­´ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã¨æ¨©é™ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚";
        elMsg.style.color = "red";
      }
    }
  }

  (function initAdminTrades() {
    loadAdminTrades();
    if (btnReload) {
      btnReload.addEventListener("click", (e) => {
        e.preventDefault();
        loadAdminTrades();
      });
    }
  })();
</script>
</body>
</html>

