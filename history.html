<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>CryptoX Exchange - 取引履歴</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- 外部CSS -->
  <link rel="stylesheet" href="assets/css/style.css">
</head>

<body>

<header class="site-header">
  <div class="logo">
    <div class="logo-badge">CX</div>
    CryptoX Exchange
  </div>

  <nav class="site-nav">
    <a href="index.html" class="nav-link">TOP</a>
    <a href="exchange.html" class="nav-link">トレード</a>
    <a href="wallet.html" class="nav-link">ウォレット</a>
    <a href="system-trade.html" class="nav-link">システム取引</a>
    <a href="support.html" class="nav-link">サポート</a>
    <a href="mypage.html" class="nav-link">マイページ</a>
    <a href="kyc.html" class="nav-link">KYC</a>
    <a href="history.html" class="nav-link active">取引履歴</a>
  </nav>

  <div class="header-actions">
    <a href="login.html" class="btn btn-outline btn-sm">ログイン</a>
    <a href="signup.html" class="btn btn-primary btn-sm">口座開設</a>
  </div>
</header>


<main style="max-width:980px; margin:0 auto; padding:18px 20px 26px; display:flex; flex-direction:column; gap:14px;">

  <section class="card">
    <div class="card-header">
      <div>
        <div class="card-title">取引履歴</div>
        <div class="card-sub">
          ※ 現在はフロントのみのデータ表示。  
          <br/>API連携時は /orders/history を使用します。
        </div>
      </div>
      <a href="exchange.html" class="btn btn-outline btn-sm">トレード画面へ</a>
    </div>

    <!-- FILTERS -->
    <div class="filters">
      <div class="filter-group">
        <span>種別:</span>
        <div class="chips">
          <button class="chip-btn active" data-side="all">すべて</button>
          <button class="chip-btn" data-side="buy">買い</button>
          <button class="chip-btn" data-side="sell">売り</button>
        </div>
      </div>

      <div class="filter-group">
        <span>通貨ペア:</span>
        <select id="pair-filter">
          <option value="all">すべて</option>
          <option value="BTC/USD">BTC / USD</option>
          <option value="ETH/USD">ETH / USD</option>
          <option value="SOL/USD">SOL / USD</option>
          <option value="DOGE/USD">DOGE / USD</option>
        </select>
      </div>

      <div class="filter-group">
        <span>期間:</span>
        <input type="date" id="from-date" />
        <span>〜</span>
        <input type="date" id="to-date" />
      </div>
    </div>

    <!-- TABLE -->
    <table>
      <thead>
        <tr>
          <th>日時</th>
          <th>通貨ペア</th>
          <th>サイド</th>
          <th class="amount">数量</th>
          <th class="amount">価格 (USD)</th>
          <th class="amount">約定金額 (USD)</th>
        </tr>
      </thead>
      <tbody id="history-body"></tbody>
    </table>

    <div id="no-data" class="no-data" style="display:none;">
      該当する取引はありません。
    </div>

  </section>

</main>

<script>
/* --------------------------
   現在はダミー約定履歴
   後で /orders/history API に置き換え可能
-------------------------- */
const trades = [
  { time:"2025-11-19 18:21", pair:"BTC/USD", side:"buy",  size:0.0100, price:67050.00 },
  { time:"2025-11-19 17:02", pair:"ETH/USD", side:"sell", size:0.5000, price:3210.50 },
  { time:"2025-11-18 22:15", pair:"DOGE/USD", side:"buy",  size:1000,   price:0.1700 },
  { time:"2025-11-18 19:40", pair:"SOL/USD", side:"buy",  size:5.0,    price:180.10 },
  { time:"2025-11-17 15:03", pair:"BTC/USD", side:"sell", size:0.0200, price:66500.00 },
  { time:"2025-11-16 11:25", pair:"ETH/USD", side:"buy",  size:1.0000, price:3180.00 },
];

const bodyEl = document.getElementById("history-body");
const noDataEl = document.getElementById("no-data");
const pairFilterEl = document.getElementById("pair-filter");
const fromDateEl = document.getElementById("from-date");
const toDateEl = document.getElementById("to-date");
const sideButtons = document.querySelectorAll(".chip-btn");

let currentSide = "all";

/* SIDE FILTER BUTTONS */
sideButtons.forEach(btn => {
  btn.addEventListener("click", () => {
    sideButtons.forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
    currentSide = btn.dataset.side;
    render();
  });
});

pairFilterEl.addEventListener("change", render);
fromDateEl.addEventListener("change", render);
toDateEl.addEventListener("change", render);


function render() {
  bodyEl.innerHTML = "";

  let filtered = trades.slice();

  /* side filter */
  if (currentSide !== "all") {
    filtered = filtered.filter(t => t.side === currentSide);
  }

  /* pair filter */
  const pair = pairFilterEl.value;
  if (pair !== "all") {
    filtered = filtered.filter(t => t.pair === pair);
  }

  /* date filter */
  const fromValue = fromDateEl.value;
  const toValue = toDateEl.value;

  if (fromValue) {
    const ts = new Date(fromValue + "T00:00:00").getTime();
    filtered = filtered.filter(t => new Date(t.time.replace(" ","T")).getTime() >= ts);
  }
  if (toValue) {
    const ts = new Date(toValue + "T23:59:59").getTime();
    filtered = filtered.filter(t => new Date(t.time.replace(" ","T")).getTime() <= ts);
  }

  if (filtered.length === 0) {
    noDataEl.style.display = "block";
    return;
  }

  noDataEl.style.display = "none";

  filtered.forEach(t => {
    const tr = document.createElement("tr");
    const sideClass = t.side === "buy" ? "side-buy" : "side-sell";
    const notional = t.size * t.price;

    tr.innerHTML = `
      <td>${t.time}</td>
      <td>${t.pair}</td>
      <td class="${sideClass}">${t.side === "buy" ? "買い" : "売り"}</td>
      <td class="amount">${t.size.toLocaleString("en-US",{minimumFractionDigits:4,maximumFractionDigits:4})}</td>
      <td class="amount">${t.price.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}</td>
      <td class="amount">${notional.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}</td>
    `;

    bodyEl.appendChild(tr);
  });
}

function initDates() {
  const today = new Date();
  const isoToday = today.toISOString().slice(0,10);
  toDateEl.value = isoToday;

  const weekAgo = new Date(today.getTime() - 6*86400000);
  fromDateEl.value = weekAgo.toISOString().slice(0,10);
}

initDates();
render();
</script>

</body>
</html>

